# b250m-opencore-config
OpenCore configuration for my personal desktop.

# OpenCore version tested with: 0.5.6
## macOS version tested with: 10.15.3
Please do not use this with any newer or older version as some options may no longer exist or be interpreted differently, or new options may be needed in order to successfully boot.

# Specs
- CPU: i5 6400
- Board: Gigabyte B250M-D3H (BIOS F10)
- GPU: Sapphire Radeon RX 580 4GB
- RAM: 16 GB Crucial Ballistix 2400 MHz DDR4 @ 2133MHz
- SSD: 512 GB Samsung 970 EVO
- Wifi: Fenvi T919
- Monitors: 1x BenQ XL2420T + 1x LG Flatron W2261VP
- Audio: HDMI audio via an Onkyo TX-NR609 + Realtek ALC892

# BIOS Settings
See the screenshots under the `BIOS` directory.

# OpenCore config noteworthy things

- SIP is completely enabled
- `ig-platform-id` is set to `0x19120001` for connectorless mode. This fixes JPEGs not opening properly among other things. Netflix is still broken.
- `vault.plist` is *en*abled, be sure to either disable it or generate a vault.plist
- `ScanPolicy` is set to a value that only scans NVMe drives and specific partition types. If you do not want to use an NVMe drive, you will need to change this.

## ScanPolicy enabled flags
ScanPolicy is set to a value of `525571` or binary `000010000000010100000011`. This means the following flags are set:

- `OC_SCAN_FILE_SYSTEM_LOCK` (bit 0)
- `OC_SCAN_DEVICE_LOCK` (bit 1)
- `OC_SCAN_ALLOW_FS_APFS` (bit 8)
- `OC_SCAN_ALLOW_FS_ESP` (bit 10)
- `OC_SCAN_ALLOW_DEVICE_NVME` (bit 19)

Please refer to the OpenCore manual for the meaning of these flags. In short, these flags allow scanning of APFS partitions (for macOS) and the ESP partition (for Boot Camp) on NVMe drives only.

# ACPI edits
See the ACPI subfolder.

- `EC`: EC patch
- `PLUG`: Sets `plugin-type` to 1, needed for AGPM and proper CPU power management.
- `SBUS`: System bus patches used to enable the AppleSMBusPCI kext
- `UIAC`: SSDT defining which ports to keep enabled, for USB Inject All
- `USBX`: Sets various USB power management properties
- `CpuPm`: CPU power management data generated by [ssdtPRgen](https://github.com/Piker-Alpha/ssdtPRGen.sh)

# Device Properties
- `PciRoot(0x0)/Pci(0x1f,0x3)`: Realtek ALC892
    - `layout-id`: `1`, used to tell AppleALC which layout ID to pick to get the onboard sound working.
- `PciRoot(0x0)/Pci(0x2,0x0)`: Intel HD Graphics 530
    - `ig-platform-id`: `0x19120001` (reversed) to enable a connectorless mode for the onboard graphics. Used to get acceleration working in various areas.
- `PciRoot(0x0)/Pci(0x1c,0x0)/Pci(0x0,0x0)`: Fenvi T-919
    - `brcmfx-country`: `NL` to make optimal use out of the Fenvi card and to reduce possible interference with surrounding devices.

# Drivers
Not included in this repo, I use the following drivers:

- [ApfsDriverLoader](https://github.com/acidanthera/AppleSupportPkg)
- FwRuntimeServices (in the OpenCore package)
- [HFSPlus](https://github.com/acidanthera/OcBinaryData/blob/master/Drivers/HfsPlus.efi)

# Kexts
Not included in this repo, I use the following kexts:

- [AirportBrcmFixup](https://github.com/acidanthera/AppleALC): Used to set a country code and also to disable WoWLAN to prevent unnecessary wakeups.
- [AppleALC](https://github.com/acidanthera/AppleALC): Fixes for HDMI and onboard audio
- [IntelMausi](https://github.com/acidanthera/IntelMausi): Driver for the built-in Ethernet controller
- [Lilu](https://github.com/acidanthera/Lilu): Requirement for most other kexts in this list
- [NVMeFix](https://github.com/acidanthera/NVMeFix): Fixes for NVMe drives
- [USB Inject All](https://bitbucket.org/RehabMan/os-x-usb-inject-all/src/master/): Used for injecting only USB ports which are in use, to keep the system inside the 15 port limit
- [VirtualSMC](https://github.com/acidanthera/VirtualSMC): SMC emulator
- [WhateverGreen](https://github.com/acidanthera/WhateverGreen): Required for proper functioning of both the integrated graphics card in headless/connectorless mode, and the RX580

# Current issues
## Netflix
Netflix in Safari doesn't work with error `S7363-1260-FFFFD089`. `shikigva=80` added in [WhateverGreen 1.3.6](https://github.com/acidanthera/WhateverGreen/releases/tag/1.3.6) might be able to fix this. However, this hangs my GPU as soon as Safari starts rendering any site. This still happens in 1.3.7.

## Bluetooth lag
The Fenvi card seems to have issues with Bluetooth. A ton of stuttering can be observed with a Magic Trackpad 2 and Logitech MX Master. A workaround is to connect the card to a 5GHz(?) Wi-Fi network, even if you are using Ethernet.